{% extends "layout.html" %}

{% block pageTitle %}
Challenge PCN
{% endblock %}

{% block beforeContent %}
{% include "includes/alpha-banner.html" %}
{% include "includes/back-link.html" %}
{% endblock %}

{% block content %}
<style>
    .sr-only {
  position:absolute;
  left:-10000px;
  top:auto;
  width:1px;
  height:1px;
  overflow:hidden;
  }
</style>

<div title="Error" class="govuk-error-summary govuk-!-display-none" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
    <h2 class="govuk-error-summary__title" id="error-summary-title">
      There is a problem
    </h2>
    <div class="govuk-error-summary__body">
      <ul class="govuk-list govuk-error-summary__list" id="errorSumList">
        <li class="govuk-!-display-none"id="challError1">
          <a href="#nameError">Enter a valid name</a>
        </li>
        <li class="govuk-!-display-none" id="challError2">
          <a href="#emailError">Enter a valid email address</a>
        </li>  
        <li class="govuk-!-display-none" id="challError3">
          <a href="#phoneError">Enter a valid phone number</a>
        </li>              
        <li class="govuk-!-display-none" id="challError4">
          <a href="#postcodeError">Enter a valid postcode</a>
        </li> 
         
      </ul>
    </div>
</div> 
<div class="govuk-width-container">

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-caption-l govuk-!-margin-bottom-1 govuk-!-margin-top-0">Resolve a penalty charge notice (PCN)</h1>
      <h2 class="govuk-heading-xl govuk-!-margin-bottom-5">Challenge <span aria-hidden="true" title="Penalty charge notice">PCN</span> <span class="sr-only" >Penalty charge notice</span></h2>
    </div>
  </div>

  
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
            
          
          <p class="govuk-body">Please select the <span aria-hidden="true" title="Penalty charge notice">PCN</span> <span class="sr-only" >Penalty charge notice</span> you wish to challenge below and fill out the details.</p>
          <!-- <p class="govuk-body"><b>Registration number:</b> <span id="reg">LO69 NRO</span>     <a class="govuk-link" href="flow1">Change</a> </p> -->
          <div style="overflow-x:auto;">
          <table class="govuk-table">
            <thead class="govuk-table__head">
              <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header  govuk-!-width-one-quarter" style="text-align: center;">Time until further action is taken</th>
                <th scope="col" class="govuk-table__header govuk-!-width-one-third" style="text-align: center;" >Time and date of
                  crossing</th>
                <th scope="col" class="govuk-table__header govuk-table__header" style="text-align: center;"><span aria-hidden="true" title="Penalty charge notice">PCN</span> <span class="sr-only" >Penalty charge notice</span> number</th>
                <th scope="col" class="govuk-table__header govuk-table__header--numeric" style="text-align: center;">Amount owed</th>
                <th scope="col" class="govuk-table__header govuk-table__header" style="text-align: center;"></th>
                <th scope="col" class="govuk-table__header govuk-table__header" style="text-align: center;">Select</th>

              </tr>
            </thead>
            <tbody id="tbody" class="govuk-table__body">

            </tbody>
          </table> 
        </div> 
          <!-- <a href="javascript:void(0)"><button class="govuk-button govuk-button--secondary govuk-!-margin-top-2 govuk-!-margin-bottom-2" data-module="govuk-button" style="float: right;">
            Add another <span aria-hidden="true" title="Penalty charge notice">PCN</span> <span class="sr-only" >Penalty charge notice</span>
         </button></a>  -->
         <br><br>

         <div>       

          <fieldset class="govuk-fieldset">
           <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
             <h1 class="govuk-fieldset__heading">
               Personal details
             </h1>
           </legend>
           <div class="govuk-form-group">
              <label class="govuk-label"  for="event-name">
                  Full name 
                </label>
                <span id="nameError" class="govuk-error-message govuk-!-display-none pcnError">
                  <span class="govuk-visually-hidden">Error:</span> Enter a valid name
                </span>
              <input class="govuk-input govuk-!-width-full challengeInput" id="fullName" name="event-name" type="text">
            </div>
           <div class="govuk-form-group">
              <label class="govuk-label"  for="event-name">
                  Email address 
                </label>
                <div id="event-name-hint" class="govuk-hint">
                  We will use this to send you confirmation of your challenge.
                </div>
                <span id="emailError" class="govuk-error-message govuk-!-display-none pcnError">
                  <span class="govuk-visually-hidden">Error:</span> Enter a valid email address
                </span>
              
   
              <input class="govuk-input govuk-!-width-two-thirds challengeInput" id="email" name="event-name" type="text">
            </div>
           <div class="govuk-form-group">
              <label class="govuk-label"  for="event-name">
                  Phone number 
                </label>
              
              <div id="event-name-hint" class="govuk-hint">
                Only enter a UK number
              </div>
              <span id="phoneError" class="govuk-error-message govuk-!-display-none pcnError">
                <span class="govuk-visually-hidden">Error:</span> Enter a valid phone number
              </span>
              <input class="govuk-input govuk-!-width-one-half challengeInput" id="phone" name="event-name" type="text" maxlength="11" onkeypress='return event.charCode >= 48 && event.charCode <= 57'>
            </div>
            <h3 class="govuk-heading-s">
              What is your home address?
            </h3>
            <div id="challengeHint" class="govuk-hint">
              We will send your challenge confirmation to this address.
            </div>
            <label id ="postcodeLabel" class="govuk-label govuk-heading-s" for="address-postcode"><h3 class="govuk-heading-s">Postcode</h3>
               
            </label>
            <span id="postcodeError" class="govuk-error-message govuk-!-display-none pcnError">
              <span class="govuk-visually-hidden">Error:</span> Enter a valid postcode
            </span>
            <div id="postEntry" class="govuk-form-group" style="display:block;">
              
 
              <input class="govuk-input govuk-!-width-one-quarter challengeInput" id="address-postcode" name="address-postcode" type="text" autocomplete="postal-code"><br><br>
            <button id="findAddy" class="govuk-button govuk-!-width-one-quarter govuk-!-margin-bottom-0" data-module="govuk-button">
               Find address
             </button><br><br>

             <p class="govuk-body" id="typeAddMyself"><a href="javascript:void(0)" class="govuk-link">Enter my address manually</a></p>
            </div>
            
            
            <fieldset id="addblock"class="govuk-fieldset govuk-!-display-none">

            
              <div class="govuk-form-group">
                <label class="govuk-label" for="address-line-1">
                  Building and street <span class="govuk-visually-hidden">line 1 of 2</span>
                </label>
                <input class="govuk-input" id="address-line-1" name="address-line-1" type="text" autocomplete="address-line1"></div>
            
              <div class="govuk-form-group">
                <label class="govuk-label" for="address-line-2">
                  <span class="govuk-visually-hidden">Building and street line 2 of 2</span>
                </label>
                <input class="govuk-input" id="address-line-2" name="address-line-2" type="text" autocomplete="address-line2"></div>
            
              <div class="govuk-form-group">
                <label class="govuk-label" for="address-town">
                  Town or city
                </label>
                <input class="govuk-input govuk-!-width-two-thirds" id="address-town" name="address-town" type="text" autocomplete="address-level2"></div>
            
              <div class="govuk-form-group">
                <label class="govuk-label" for="address-county">
                  County
                </label>
                <input class="govuk-input govuk-!-width-two-thirds" id="address-county" name="address-county" type="text"></div>
            
              <div class="govuk-form-group">
                <label class="govuk-label" for="address-postcode">
                  Postcode
                </label>
                <input class="govuk-input govuk-input--width-10 govuk-!-margin-bottom-2" id="address-postcode-2" name="address-postcode" type="text" autocomplete="postal-code">
                <!--<p class="govuk-body" id="autofindAdd"><a href="javascript:void(0)" class="govuk-link govuk-!-display-block">Find my address automatically by postcode</a></p>-->
              </div>
                
            </fieldset>
             
 <div id="addySelect"class="govuk-form-group govuk-!-margin-bottom-0" style="display:none;">

   <h3 id="showCode"class="govuk-heading-s"></h3>
   <select class="govuk-select" id="sort" name="sort">
   <option id="addyCount" selected disabled></option>  
   </select><br><br>
 
   <p class="govuk-body"><a id = "noAddy" href="javascript:void(0)">I can't find my address in the list</a></p>
   <button id="foundAddy " onclick="window.location.href='flow10'"  class="govuk-button govuk-!-width-one-quarter" data-module="govuk-button">
               Continue
             </button>
 </div>


         </fieldset>
    <div id="defaultNext" class="govuk-!-display-none">
      <a id='nextPage' href="flow10">
        <button class="govuk-button govuk-!-width-one-quarter" data-module="govuk-button">
          Next
        </button> 
      </a> 
    </div>    



  <br>
  <br><br><br><br>
  </div> 
  
  
                      </div>
                     


                      
        <div class="govuk-grid-column-one-third">
          
        </div>
      </div>
  
    </main>
  </div> 



<script src="/public/javascripts/jquery-1.11.3.js"></script>
<script type="text/javascript">
var chosen = JSON.parse(localStorage.getItem("chosenCar"));
  $(document).ready(function() {
  
  
  var chosenFull = JSON.parse(localStorage.getItem("chosenCarfull"));
  $("#reg").html(chosen[0]) ; 
  $("#cla").html(chosen[1]);  
  $("#make").html(chosen[2]);  
  $("#model").html(chosen[3]);  
  $("#color").html(chosen[4]);
  $("#pcns").html(chosenFull[0].penalties.length);
  
  if ((chosenFull[0].penalties.length >1)||(chosenFull[0].penalties.length<1)){
    $("#grammar1").html("are");  
    $("#grammar2").html("s");
  }
  else {
    $("#grammar1").html("is");  
    $("#grammar2").html("");
    // $("#grammar3").html("It is on its way");
    // $("#grammar4").html("it.");

  }
  


  })
</script>
<script type="text/javascript">
let postcodes = [{"postcode":"CM1 7BD", "addresses":["Broomfield Hall, Church Green, Broomfield, CHELMSFORD, CM1 7BD", "Woollards, Church Green, Broomfield, CHELMSFORD, CM1 7BD", "2 Church Green, Broomfield, CHELMSFORD, CM1 7BD", "BROOMFIELD HOUSE MANAGEMENT COMPANY LIMITED, 25 CHURCH GREEN" , "MARINA ONE SECURITY SERVICES LTD, 41 CHURCH GREEN, BROOMFIELD"
] }, {"postcode":"NW10 5AD", "addresses": ["1 Buchanan Gardens, LONDON", "3b Buchanan Gardens", "Flat B, 5 Buchanan Gardens, LONDON,", "SAMIR HUSSEIN PHOTOGRAPHY LTD, 33 BUCHANAN GARDENS, LONDON", "RUSKONE VINTAGE DESIGN LIMITED, 47A BUCHANAN GARDENS, WILLESDEN, LONDON,"]}]

localStorage.setItem("postcodes", JSON.stringify(postcodes));
</script>
<script>
    $(document).ready(function() {
    var pcn_fields = JSON.parse(localStorage.getItem("pcn_fields"));
    var chosenFull = JSON.parse(localStorage.getItem("chosenCarfull"));
    let penaltyDetails =[];
        for (k = 0; k < pcn_fields.length; k++){
          for (j = 0; j < chosenFull.length; j++) { 
            for (i = 0; i < chosenFull[j].penalties.length; i++){
              if (pcn_fields[k].replace(/\s/g, "") === chosenFull[j].penalties[i].pcn.replace(/\s/g, "")){
                  penaltyDetails.push(chosenFull[j].penalties[i])
               };
           }
          }
        }
    
  
  for (w=0; w<penaltyDetails.length; w++){
  let fieldHTML = `<tr  class="govuk-table__row">
              <td class="govuk-table__cell govuk-table__cell" style="text-align: center;">${penaltyDetails[w].daysToEsc}</td>
              <td class="govuk-table__cell govuk-table__cell" >${penaltyDetails[w].conTime} on ${penaltyDetails[w].conDate}</td>
              <td class="govuk-table__cell govuk-table__cell" >${penaltyDetails[w].pcn}</td>
              <td class="govuk-table__cell govuk-table__cell--numeric"  name="pay" style="text-align: center;">${penaltyDetails[w].charge}</td>
              <td class="govuk-table__cell govuk-table__cell" ><a name="details" class="govuk-link" href="flow5details">Details</a></td>
              <td class="govuk-table__cell govuk-table__cell" >
                <div class="govuk-checkboxes govuk-checkboxes--small govuk-checkboxes__item" data-module="govuk-checkboxes" style="margin-left:20%; padding-top: 10%;">
                  <input class="govuk-checkboxes__input"  name="organisation" type="checkbox" value=""  onchange="checkCharge()" checked>
                  <label class="govuk-label govuk-checkboxes__label govuk-!-padding-right-0" for="organisation-2">
                  </label>
                  </div>
              </td>
            </tr>`;
  document.getElementById("tbody").innerHTML += fieldHTML;
  let noAddy = document.getElementById("noAddy")
  let foundAddy = document.getElementById("addySelect")
  let addyBtn = document.getElementById("findAddy");

  
  let postEntry = document.getElementById("postEntry")
  let chosenAddy = []
  
  let container = document.getElementById('sort')

  // window.addEventListener('load', (event) => {

    // function checkAddy(){
    addyBtn.addEventListener("click", function (event){ 
    for (let i=0; i<postcodes.length; i++){
      
      if (document.getElementById("address-postcode").value.toUpperCase().replace(/\s/g, "")==
        postcodes[i].postcode.toUpperCase().replace(/\s/g, "")){
        chosenAddy = postcodes[i].addresses;
        localStorage.setItem("chosenAddy", JSON.stringify(chosenAddy));
        document.getElementById("addyCount").innerHTML=`${chosenAddy.length} address(es) found`
        document.getElementById("challengeHint").style.display="none"
        document.getElementById("showCode").innerHTML=postcodes[i].postcode
      for (let k=0; k<chosenAddy.length; k++){
          let fieldHTML = `<option value="${chosenAddy[k]}">${chosenAddy[k]}</option>`;
          container.innerHTML+=fieldHTML;
          foundAddy.style.display="block";
          postEntry.style.display="none";
          
        } 

      };

        

    }
  })

  let defaultNext = document.getElementById("defaultNext")
  let postcodeLabel = document.getElementById("postcodeLabel")
  let addblock = document.getElementById("addblock")
  let typeAddMyself = document.getElementById("typeAddMyself")
  let autofindAdd = document.getElementById("autofindAdd")
  typeAddMyself.addEventListener("click", function (){
    postEntry.style.display="none";
    addblock.classList.remove("govuk-!-display-none")
    defaultNext.classList.remove("govuk-!-display-none")
    postcodeLabel.classList.add("govuk-!-display-none")
  })
    // });
      noAddy.addEventListener("click", function (){        
      // chosenAddy = []
      //  window.location.reload()
      foundAddy.style.display="none";
          postEntry.style.display="block";
          document.getElementById("challengeHint").style.display="block"     
        })

        // autofindAdd.addEventListener("click", function (){
        //   postEntry.style.display="block";
        //   addblock.classList.add("govuk-!-display-none")
        //   defaultNext.classList.add("govuk-!-display-none")
        //   postcodeLabel.classList.remove("govuk-!-display-none")
          
        // })
  
  // }
  // checkAddy()
  function autoFill(){
    // let deets = [document.getElementById("fullName").value]
    if (document.getElementById("fullName").value ===""){
      document.getElementById("fullName").value = "John Doe"
      // deets = [document.getElementById("fullName").value]
      // localStorage.setItem("challengeDetails", JSON.stringify(deets))
    }
    if (document.getElementById("email").value===""){
      document.getElementById("email").value= "johndoe@email.com"
    }
    if (document.getElementById("phone").value===""){
      document.getElementById("phone").value= "08219919918"
    }
    if (document.getElementById("address-postcode").value===""){
      document.getElementById("address-postcode").value= "CM17BD"
    }
    if (document.getElementById("address-line-1").value===""){
      document.getElementById("address-line-1").value= "2 Church Green"
    }
    if (document.getElementById("address-line-2").value===""){
      document.getElementById("address-line-2").value= "Broomfield"
    }
    if (document.getElementById("address-town").value===""){
      document.getElementById("address-town").value= "Chelmsford"
    }
    if (document.getElementById("address-county").value===""){
      document.getElementById("address-county").value= "Essex"
    }
    if (document.getElementById("address-postcode-2").value===""){
      document.getElementById("address-postcode-2").value= "CM17BD"
    }
    let deets = [document.getElementById("fullName").value]
    localStorage.setItem("challengeDetails", JSON.stringify(deets))
  }
  addyBtn.addEventListener("mouseover", function(){
    if (document.getElementById("fullName").value ===""){
      document.getElementById("fullName").value = "John Doe"
      // deets = [document.getElementById("fullName").value]
      // localStorage.setItem("challengeDetails", JSON.stringify(deets))
    }
    if (document.getElementById("email").value===""){
      document.getElementById("email").value= "johndoe@email.com"
    }
    if (document.getElementById("phone").value===""){
      document.getElementById("phone").value= "08219919918"
    }
    if (document.getElementById("address-postcode").value===""){
      document.getElementById("address-postcode").value= "CM17BD"
    }
  })
  let defaultDetails = document.getElementById("defaultDetails")
  // defaultDetails.addEventListener("mouseover", function(){
    document.getElementById('nextPage').addEventListener("mouseover", function(){
    autoFill()
    let challengedPCNs = []
    for (let k=0; k<document.getElementsByName('organisation').length; k++){
      if (document.getElementsByName('organisation')[k].checked){
      challengedPCNs.push(penaltyDetails[k].pcn)}
    }
    localStorage.setItem("challengedPCNs", JSON.stringify(challengedPCNs)) 
 })
  
  foundAddy.addEventListener("click", function() {
    let fullName =document.getElementById("fullName").value 
    let email = document.getElementById("email").value
    let phone = document.getElementById("phone").value
    let showCode = document.getElementById("showCode").innerHTML
    let sort =document.getElementById("sort")
    let homeAddy = sort.options[sort.selectedIndex].value
    let challengeDetails = [fullName, email, phone, showCode, homeAddy]
    localStorage.setItem("challengeDetails", JSON.stringify(challengeDetails))
    let checkslist = document.getElementsByName('organisation')
    let challengedPCNs = []
    for (let k=0; k<checkslist.length; k++){
      if (checkslist[k].checked){
      challengedPCNs.push(penaltyDetails[k].pcn)
      
    }
    
  }
  localStorage.setItem("challengedPCNs", JSON.stringify(challengedPCNs))
  })
                    }
  // localStorage.setItem("penaltyDetails",JSON.stringify(penaltyDetails));
  // let pcnDetailslinks = document.getElementsByName("details");
  // let pcnDetailsTable = [];
  // for (let g=0; g<pcnDetailslinks.length; g++){
  //   // pcnDetailslinks[g].addEventListener("mouseover", function(){
  //   pcnDetailslinks[g].addEventListener("click", function(){
  //     pcnDetailsTable = (chosen.concat(Object.values(penaltyDetails[g]))) 
  //     localStorage.setItem("pcnDetailsTable",JSON.stringify(pcnDetailsTable));
  //      });
        
  // };
  // let confirmPayBTN = document.getElementById("confirmPayBTN");
  
  // let checkslist = document.getElementsByName('organisation')

  // confirmPayBTN.addEventListener("click", function(){
  //   for (let k=0; k<checkslist.length; k++){
  //     if (checkslist[k].checked){
  //       pcnDetailsTable.push((chosen.concat(Object.values(penaltyDetails[k]))))
  //     }
  //   }
  //   if(pcnDetailsTable.length>1){
  //     pcnDetailsTable=pcnDetailsTable
  //   }else if(pcnDetailsTable.length=1){pcnDetailsTable=pcnDetailsTable.flat(1)}
  //   localStorage.setItem("pcnDetailsTable",JSON.stringify(pcnDetailsTable));
  // })
     let challengeInputs  = document.getElementsByClassName("challengeInput");
     let confirmPay = document.getElementById("confirmPay");
     
     function payValidate (){
      let errorSummary = document.querySelector(".govuk-error-summary")
      // const errorSpan = `<span id="pcnError${i}" class="govuk-error-message pcnError"><span class="govuk-visually-hidden">Error:</span> Enter a valid PCN number</span>`
      
      let nameError = document.querySelector("#nameError")
      let emailError = document.querySelector("#emailError")
      let phoneError = document.querySelector("#phoneError")
      let postcodeError = document.querySelector("#postcodeError")
      
      let challError1 = document.querySelector("#challError1")
      let challError2 = document.querySelector("#challError2")
      let challError3 = document.querySelector("#challError3")
      let challError4 = document.querySelector("#challError4")
      
      //  validate credit card number
       
      
      
      if (challengeInputs[0].value===""||challengeInputs[0].value.length<2){
        event.preventDefault()

        errorSummary.classList.remove("govuk-!-display-none")
        // regField.setAttribute("value", "Invalid VRN")
        // pcnEntries[i].insertAdjacentHTML("beforebegin", errorSpan)
        challengeInputs[0].setAttribute("aria-describedby", "reg_field-error")
        challengeInputs[0].classList.add("govuk-input--error")
        challengeInputs[0].parentElement.classList.add("govuk-form-group--error")
        challError1.classList.remove("govuk-!-display-none")
        nameError.classList.remove("govuk-!-display-none")
        errorSummary.focus()
       }
       if (challengeInputs[0].value.length>1){
                
        // errorSummary.classList.add("govuk-!-display-none")
        // regField.setAttribute("value", "Invalid VRN")
        // pcnEntries[i].insertAdjacentHTML("beforebegin", errorSpan)
        challengeInputs[0].setAttribute("aria-describedby", "reg_field-error")
        challengeInputs[0].classList.remove("govuk-input--error")
        challengeInputs[0].parentElement.classList.remove("govuk-form-group--error")
        challError1.classList.add("govuk-!-display-none")
        nameError.classList.add("govuk-!-display-none")                          
       }


       if (!challengeInputs[1].value.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/)) {
        event.preventDefault()

        errorSummary.classList.remove("govuk-!-display-none")
        // regField.setAttribute("value", "Invalid VRN")
        // pcnEntries[i].insertAdjacentHTML("beforebegin", errorSpan)
        challengeInputs[1].setAttribute("aria-describedby", "reg_field-error")
        challengeInputs[1].classList.add("govuk-input--error")
        challengeInputs[1].parentElement.classList.add("govuk-form-group--error")
        challError2.classList.remove("govuk-!-display-none")
        emailError.classList.remove("govuk-!-display-none")
        errorSummary.focus()
       }
       if (challengeInputs[1].value.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/)) {
                
        // errorSummary.classList.add("govuk-!-display-none")
        // regField.setAttribute("value", "Invalid VRN")
        // pcnEntries[i].insertAdjacentHTML("beforebegin", errorSpan)
        challengeInputs[1].setAttribute("aria-describedby", "reg_field-error")
        challengeInputs[1].classList.remove("govuk-input--error")
        challengeInputs[1].parentElement.classList.remove("govuk-form-group--error")
        challError2.classList.add("govuk-!-display-none")
        emailError.classList.add("govuk-!-display-none")
        
       }


       
       if (challengeInputs[2].value.length!=11) {
        event.preventDefault()

        errorSummary.classList.remove("govuk-!-display-none")
        // regField.setAttribute("value", "Invalid VRN")
        // pcnEntries[i].insertAdjacentHTML("beforebegin", errorSpan)
        challengeInputs[2].setAttribute("aria-describedby", "reg_field-error")
        challengeInputs[2].classList.add("govuk-input--error")
        challengeInputs[2].parentElement.classList.add("govuk-form-group--error")
        challError3.classList.remove("govuk-!-display-none")
        phoneError.classList.remove("govuk-!-display-none")
        errorSummary.focus()
       }
       if (challengeInputs[2].value.length==11) {
                
        //  errorSummary.classList.remove("govuk-!-display-none")
         // regField.setAttribute("value", "Invalid VRN")
         // pcnEntries[i].insertAdjacentHTML("beforebegin", errorSpan)
         challengeInputs[2].setAttribute("aria-describedby", "reg_field-error")
         challengeInputs[2].classList.remove("govuk-input--error")
         challengeInputs[2].parentElement.classList.remove("govuk-form-group--error")
         challError3.classList.add("govuk-!-display-none")
         phoneError.classList.add("govuk-!-display-none")                                  
        }      
        
        
       if (challengeInputs[3].value<4||challengeInputs[3].value>7) {
        event.preventDefault()

        errorSummary.classList.remove("govuk-!-display-none")
        // regField.setAttribute("value", "Invalid VRN")
        // pcnEntries[i].insertAdjacentHTML("beforebegin", errorSpan)
        challengeInputs[3].setAttribute("aria-describedby", "reg_field-error")
        challengeInputs[3].classList.add("govuk-input--error")
        challengeInputs[3].parentElement.classList.add("govuk-form-group--error")
        challError4.classList.remove("govuk-!-display-none")
        postcodeError.classList.remove("govuk-!-display-none")
        errorSummary.focus()
       }
       if (challengeInputs[3].value>=4 && challengeInputs[3].value<=7) {
                
        // errorSummary.classList.add("govuk-!-display-none")
        // regField.setAttribute("value", "Invalid VRN")
        // pcnEntries[i].insertAdjacentHTML("beforebegin", errorSpan)
        challengeInputs[3].setAttribute("aria-describedby", "reg_field-error")
        challengeInputs[3].classList.remove("govuk-input--error")
        challengeInputs[3].parentElement.classList.remove("govuk-form-group--error")
        challError4.classList.add("govuk-!-display-none")
        postcodeError.classList.add("govuk-!-display-none")                          
       }
      }
      let nextPage = document.getElementById("nextPage")
       nextPage.addEventListener("click", function(){
       payValidate()
     })
  
    })
  
</script>
<script type="text/javascript">
   $(document).ready(function(){
   let checks = document.getElementsByName('organisation')
   let sumBox = document.querySelector('#amt_owed')
   let payFields = document.getElementsByName('pay')
  //  const pcnCount = document.getElementById('pcnCount')

  

    function setIt(){
        for(i=0; i<payFields.length; i++) { 
            checks[i].value = parseInt(payFields[i].innerText.split('Â£')[1]);
        }
    }
    setIt();
    // function setPcnCount(){
    //   pcnCount.innerText =payFields.length
    // }
    // setPcnCount();
  //     function checkTotal() {
        
  //       document.listForm.total.value = '35';
  //       var sum = 0;
  //       for (i=0;i<document.listForm.choice.length;i++) {
  //         if (document.listForm.choice[i].checked) {
  //           sum = sum + parseInt(document.listForm.choice[i].value);
  //         }
  //       }
  //       document.listForm.total.value = sum;
  //     }
  // //     function checkCharge() {
        
  //       sumBox.value = '105';
  //       var sum = 0;
  //       for (i=0;i<checks.length;i++) {
  //         if (checks[i].checked) {
  //           sum = sum + parseInt(checks[i].value);
  //         }
  //       }
  //       sumBox.value = sum;
  //     }
        $(function() {

        function getTotal(isInit) {

          var total = 0;
          var selector = isInit ? ".govuk-checkboxes__input" : ".govuk-checkboxes__input:checked";
          $(selector).each(function() {
            total += parseInt($(this).val());
          });
          //$("#tot_amount").val(sum.toFixed(3));

          if (total == 0) {
            $('#amt_owed').val('0');
          } else {
            $('#amt_owed').val(total);
          }

        }

        $(".govuk-checkboxes__input").click(function(event) {
          getTotal();
        });
        getTotal(true);

        });

      })
</script>

{% endblock %}
